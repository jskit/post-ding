#! /usr/bin/env node



const request = require('request');
const program = require('commander');

const version = require('../package.json').version;

const list = {
  hsq1: '好食期：支付宝拼团小程序',
  hsq2: '好食期：支付宝积分小程序',
  iqg1: '爱抢购：一元餐小程序',
  iqg2: '爱抢购：一元抢插件',
}

function miniApp(type) {
  return list[type];
}

program
  .version(version)
  // .usage('[options] <file ...>')
  .option('-m, --message <n>', '发布消息')
  .option('-t, --type <n>', '小程序名称', miniApp)
  // .option('-r, --range <a>..<b>', 'A range', range)
  // .option('-l, --list <items>', 'A list', list)
  // .option('-o, --optional [value]', 'An optional value')
  // .option('-c, --collect [value]', 'A repeatable value', collect, [])
  // .option('-v, --verbose', 'A value that can be increased', increaseVerbosity, 0)
  .parse(process.argv);

// node ./src/postding.js -t hsq2  -m @2.1.0
console.log(program.type, program.message)
if (!program.type) {
  return '请输出正确的参数 postding --help';
}

const msgTip = `${program.type}${program.message}发布啦`;

const url = 'https://oapi.dingtalk.com/robot/send?access_token=38e6757164adfb68852b6ec0ce9151d797b091ceb11b9343fb8258f9954ca56b';

// https://oapi.dingtalk.com/robot/send?access_token=38e6757164adfb68852b6ec0ce9151d797b091ceb11b9343fb8258f9954ca56b


const message = {
  "msgtype": "text",
  "text": {
    "content": msgTip,
  },
  "at": {
    "isAtAll": true
  }
}

var options = {
  method: 'POST',
  url,
  headers: {
    'User-Agent': 'request',
    'Content-Type': 'application/json',
  },
  // json: true,
  body: JSON.stringify(message),
};


request(options, function (error, response, body) {
  if (error) {
    return console.error('upload failed:', error);
  }
  console.log('Upload successful!  Server responded with:', body);
})



